#!/bin/sh
attempt=0
while ! [ -f /run/flannel/subnet.env ]; do 
    if (( attempt > 200 )); then
        echo "Not able to find flannel environment subnet file. Bailing out"
        exit 2
    fi
    attempt=$((attempt+1))
    sleep 3
done

. /run/flannel/subnet.env

export FLANNEL_SUBNET

export FLANNEL_MTU

echo "# DO NOT EDIT THIS FILE. THIS FILE IS MAINTAINED BY PRE DOCKER SCRIPT TO INITALIZE DOCKER WITH CORRECT SUBNET" | sudo tee /etc/default/docker

echo "# Please update /etc/kubernetes/default.docker.template and then restart docker." | sudo tee -a /etc/default/docker


envsubst < /etc/kubernetes/default.docker.template | sudo tee -a /etc/default/docker